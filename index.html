<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ambition Board</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;600&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #fafafa;
      color: #333;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      cursor: grab;
      user-select: none;
    }

    body.dragging { cursor: grabbing; }

    #canvas {
      position: absolute;
      width: 2000px;
      height: 2000px;
    }

    /* Grid lines */
    /* Quadrant backgrounds */
    .quad-bg {
      position: absolute;
      width: 10000px;
      height: 10000px;
    }
    .quad-bg-close-big  { left: -9000px; top: -9000px;  background: rgba(230, 126, 34, 0.07); }
    .quad-bg-far-big    { left: 1000px;  top: -9000px;  background: rgba(142, 68, 173, 0.07); }
    .quad-bg-close-small { left: -9000px; top: 1000px;   background: rgba(39, 174, 96, 0.07); }
    .quad-bg-far-small  { left: 1000px;  top: 1000px;   background: rgba(52, 152, 219, 0.07); }

    .axis-line-h, .axis-line-v {
      position: absolute;
      background: #bbb;
    }
    .axis-line-h {
      width: 100%;
      height: 2px;
      top: 1000px;
      left: 0;
    }
    .axis-line-v {
      height: 100%;
      width: 2px;
      left: 1000px;
      top: 0;
    }

    /* Axis labels */
    .axis-label {
      position: fixed;
      font-size: 0.75rem;
      font-weight: 400;
      letter-spacing: 0.2em;
      color: #555;
      white-space: nowrap;
      z-index: 100;
      pointer-events: none;
    }

    .axis-label-top    { left: 50%; top: 1rem; transform: translateX(-50%); }
    .axis-label-bottom { left: 50%; bottom: 1rem; transform: translateX(-50%); }
    .axis-label-left   { top: 50%; left: 1rem; transform: translateY(-50%); }
    .axis-label-right  { top: 50%; right: 1rem; transform: translateY(-50%); }

    /* Quadrant labels removed */

    /* Items */
    .item {
      position: absolute;
      background: #fff;
      border-radius: 10px;
      padding: 0.8rem 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border-left: 3px solid #ddd;
      max-width: 260px;
      font-size: 0.9rem;
      line-height: 1.6;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      cursor: default;
    }

    .item:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .item.q-close-big   { border-left-color: #e67e22; }
    .item.q-far-big     { border-left-color: #8e44ad; }
    .item.q-close-small  { border-left-color: #27ae60; }
    .item.q-far-small   { border-left-color: #3498db; }

    .item.done {
      opacity: 0.6;
      border-left-color: #aaa !important;
      background: #f5f5f5;
    }
    .item.done .text { text-decoration: line-through; color: #999; }
    .item.done .done-badge {
      display: inline-block;
      font-size: 0.65rem;
      background: #27ae60;
      color: #fff;
      padding: 0.1rem 0.4rem;
      border-radius: 4px;
      margin-left: 0.4rem;
      font-weight: 600;
    }

    .item .emoji { margin-right: 0.3rem; }
    .item .date {
      font-size: 0.65rem;
      color: #bbb;
      margin-top: 0.3rem;
    }

    /* Center origin marker */
    .origin {
      position: absolute;
      left: 993px;
      top: 993px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #ddd;
    }

    /* Header overlay */
    #header {
      position: fixed;
      top: 1.5rem;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 100;
      pointer-events: none;
    }

    #header h1 {
      font-weight: 300;
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      color: #222;
      background: rgba(250,250,250,0.85);
      padding: 0.3rem 1.2rem;
      border-radius: 8px;
      backdrop-filter: blur(4px);
    }

    #header p {
      font-size: 0.75rem;
      color: #aaa;
      margin-top: 0.2rem;
    }

    /* Minimap */
    #minimap {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 120px;
      height: 120px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      z-index: 100;
      overflow: hidden;
      backdrop-filter: blur(4px);
    }

    #minimap .mm-cross-h, #minimap .mm-cross-v {
      position: absolute;
      background: #e0e0e0;
    }
    #minimap .mm-cross-h { width: 100%; height: 1px; top: 50%; }
    #minimap .mm-cross-v { height: 100%; width: 1px; left: 50%; }

    #minimap .mm-viewport {
      position: absolute;
      border: 1.5px solid #e67e22;
      border-radius: 2px;
      opacity: 0.6;
    }

    #minimap .mm-dot {
      position: absolute;
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: #666;
    }
  </style>
</head>
<body>
  <div id="header">
    <h1>Ambition Board</h1>
    <p>野望は、書き出した瞬間から動き出す</p>
  </div>

  <div id="canvas">
    <div class="quad-bg quad-bg-close-big"></div>
    <div class="quad-bg quad-bg-far-big"></div>
    <div class="quad-bg quad-bg-close-small"></div>
    <div class="quad-bg quad-bg-far-small"></div>
    <div class="axis-line-h"></div>
    <div class="axis-line-v"></div>
    <div class="origin"></div>

    <!-- axis labels moved to fixed overlay -->

    <!-- quadrant labels removed -->
  </div>

  <div class="axis-label axis-label-top">↑ 壮大な野望</div>
  <div class="axis-label axis-label-bottom">↓ 身近な望み</div>
  <div class="axis-label axis-label-left">← すぐ手を出せる</div>
  <div class="axis-label axis-label-right">いつかきっと →</div>

  <div id="minimap">
    <div class="mm-cross-h"></div>
    <div class="mm-cross-v"></div>
    <div class="mm-viewport" id="mm-viewport"></div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const CANVAS_SIZE = 2000;
    const CENTER = CANVAS_SIZE / 2;

    // --- Pan & scroll ---
    let panX = -(CENTER - window.innerWidth / 2);
    let panY = -(CENTER - window.innerHeight / 2);
    let zoom = 1;
    const ZOOM_MIN = 0.3;
    const ZOOM_MAX = 2;
    let isDragging = false;
    let dragStartX, dragStartY;

    function applyTransform() {
      canvas.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
      canvas.style.transformOrigin = '0 0';
      // Counter-scale items so they stay the same visual size
      document.querySelectorAll('.item').forEach(el => {
        el.style.transform = `scale(${1 / zoom})`;
        el.style.transformOrigin = 'top left';
      });
      updateMinimap();
    }

    document.addEventListener('mousedown', (e) => {
      if (e.target.closest('#minimap')) return;
      isDragging = true;
      dragStartX = e.clientX - panX;
      dragStartY = e.clientY - panY;
      document.body.classList.add('dragging');
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      panX = e.clientX - dragStartX;
      panY = e.clientY - dragStartY;
      applyTransform();
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      document.body.classList.remove('dragging');
    });

    // Wheel zoom
    document.addEventListener('wheel', (e) => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? 0.9 : 1.1;
      const newZoom = Math.min(ZOOM_MAX, Math.max(ZOOM_MIN, zoom * delta));
      // Zoom toward cursor
      const mouseX = e.clientX;
      const mouseY = e.clientY;
      const canvasX = (mouseX - panX) / zoom;
      const canvasY = (mouseY - panY) / zoom;
      zoom = newZoom;
      panX = mouseX - canvasX * zoom;
      panY = mouseY - canvasY * zoom;
      applyTransform();
    }, { passive: false });

    // Touch support
    let touchStartX, touchStartY;
    document.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX - panX;
        touchStartY = e.touches[0].clientY - panY;
      }
    });
    document.addEventListener('touchmove', (e) => {
      if (e.touches.length === 1) {
        e.preventDefault();
        panX = e.touches[0].clientX - touchStartX;
        panY = e.touches[0].clientY - touchStartY;
        applyTransform();
      }
    }, { passive: false });

    // --- Minimap ---
    function updateMinimap() {
      const vp = document.getElementById('mm-viewport');
      const scale = 120 / CANVAS_SIZE;
      const vw = window.innerWidth * scale;
      const vh = window.innerHeight * scale;
      const vx = -panX * scale;
      const vy = -panY * scale;
      vp.style.width = vw + 'px';
      vp.style.height = vh + 'px';
      vp.style.left = vx + 'px';
      vp.style.top = vy + 'px';
    }

    // --- Load items ---
    async function loadAmbitions() {
      try {
        const res = await fetch('data/ambitions.json');
        const data = await res.json();
        renderItems(data);
      } catch (e) {
        console.error('Failed to load ambitions:', e);
      }
    }

    // Quadrant regions: map quadrant name to a region around center
    const QUADRANT_REGIONS = {
      'close-big':  { xMin: -400, xMax: -50, yMin: -400, yMax: -50 },
      'far-big':    { xMin: 50,   xMax: 400, yMin: -400, yMax: -50 },
      'close-small': { xMin: -400, xMax: -50, yMin: 50,   yMax: 400 },
      'far-small':  { xMin: 50,   xMax: 400, yMin: 50,   yMax: 400 },
    };

    function seededRandom(seed) {
      let h = 0;
      for (let i = 0; i < seed.length; i++) {
        h = ((h << 5) - h + seed.charCodeAt(i)) | 0;
      }
      return () => {
        h = (h * 16807 + 0) % 2147483647;
        return (h & 0x7fffffff) / 2147483647;
      };
    }

    function renderItems(items) {
      // Remove old items
      document.querySelectorAll('.item').forEach(el => el.remove());
      document.querySelectorAll('.mm-dot').forEach(el => el.remove());

      const minimap = document.getElementById('minimap');

      items.forEach(item => {
        const region = QUADRANT_REGIONS[item.quadrant];
        if (!region) return;

        const rng = seededRandom(item.text + item.id);
        const x = CENTER + region.xMin + rng() * (region.xMax - region.xMin);
        const y = CENTER + region.yMin + rng() * (region.yMax - region.yMin);

        const el = document.createElement('div');
        const isDone = !!item.doneAt;
        el.className = `item q-${item.quadrant}${isDone ? ' done' : ''}`;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        const badge = isDone ? '<span class="done-badge">✓ DONE</span>' : '';
        el.innerHTML = `
          <span class="emoji">${item.emoji || ''}</span><span class="text">${item.text}</span>${badge}
          <div class="date">${item.addedAt}${isDone ? ' → ' + item.doneAt : ''}</div>
        `;
        canvas.appendChild(el);

        // Minimap dot
        const dot = document.createElement('div');
        dot.className = 'mm-dot';
        dot.style.left = (x / CANVAS_SIZE * 120) + 'px';
        dot.style.top = (y / CANVAS_SIZE * 120) + 'px';
        minimap.appendChild(dot);
      });
    }

    applyTransform();
    loadAmbitions();
  </script>
</body>
</html>
